# 🧠 Bittensor 子网收益模拟器 (v2.1)

一个专业、高精度的 Bittensor 子网经济模型分析、策略优化及多场景对比工具。本项目精确复现了 `subtensor` 链上核心的经济逻辑，完全符合 Bittensor v3.2.0 规范，并提供可交互的 Web 界面，帮助您做出更明智的投资决策。

## 🌟 v2.1 主要升级

| 功能 | v2.0 | v2.1 | 改进说明 |
|------|------|------|----------|
| α_base 范围 | 0.001-0.2 | **0.0001-0.2** | 支持更精细的价格控制 |
| α_base 默认值 | 0.1526 | **0.0003** | 使用链上验证的实际值 |
| 策略开始时间 | 固定 7200 区块 | **1-N 区块（可配）** | 独立于 TAO 免疫期 |
| 时间输入方式 | 仅区块数 | **天数 + 区块数** | 双重输入，自动转换 |
| EMA 公式 | 近似实现 | **完全符合 v3.2.0** | α(t) = α_base × (t/(t+T_half)) |

## ✨ 核心特性

*   **🎛️ 精确的经济模型**: 严格遵循 `subtensor` 源码，实现了动态 TAO 发行、基于 EMA 价格的份额计算、AMM 资金池运作以及 Epoch 周期的奖励分配。
*   **🔬 灵活的场景模拟**:
    *   **可调 `α_base` 参数**: 范围 0.0001-0.2，默认值 0.0003（链上验证值），精确控制 EMA 价格收敛速度。
    *   **可调 TAO 产生速率**: 模拟网络在不同发行阶段（如减半后）的宏观经济状况。
    *   **可调奖励份额**: 精确模拟您在子网中所占的贡献比例。
    *   **可调市场抛压**: 通过"外部卖出压力"参数，模拟其他参与者（包括 Root 验证者）的市场行为。
    *   **灵活的策略开始时间**: 支持天数/区块数双重输入，策略执行与 TAO 免疫期独立配置。
*   **📈 交互式可视化界面**: 基于 Streamlit 构建，所有参数均可通过滑块实时调节，结果即时反馈。
*   **🔄 双阶段投资策略**: 支持初始投资 + 二次增持的复合投资策略，更贴近真实投资场景。
*   **🚀 一键部署**: 支持本地运行，无需复杂配置。

## 🚀 快速开始

### 本地运行

```bash
# 克隆最新版本的项目
git clone https://github.com/MrHardcandy/bittensor-alpha-simulator.git
cd bittensor-alpha-simulator

# (推荐) 创建并激活虚拟环境
python3 -m venv sim_env
source sim_env/bin/activate

# 安装依赖
pip install -r requirements.txt

# 启动Web界面
streamlit run app.py
```

启动后，访问浏览器中提示的地址（通常是 `http://localhost:8501`）。

## 🎛️ 关键可调参数详解

所有参数均可在左侧边栏进行调整。

#### 核心环境参数

*   **TAO产生速率 (个/12秒)**: 控制每个区块全网产生的 TAO 数量。这是影响整个模拟经济体中资金流入速度的最宏观变量。
*   **α_base（基准Alpha系数）**: EMA 公式中的基准系数，遵循 `α(t) = α_base × (t / (t + T_half))` 规范。
    *   **链上验证值**: 0.0003（Bittensor v3.2.0 实际链上参数）
    *   **调节范围**: 0.0001-0.2，支持精细调整
    *   **低值 (e.g., 0.0001)**: 价格极其稳定，适合模拟成熟子网
    *   **高值 (e.g., 0.1)**: 价格快速收敛，适合模拟新兴子网

#### 收益与市场行为参数

*   **我的奖励份额 (%)**: 决定了在每个 Epoch 周期结算时，您能获得 dTAO 总奖励的百分比。例如，设为 `59%` 表示您获得了 59% 的奖励，另外 41% 被视为外部参与者的。
*   **外部卖出压力 (%)**: 决定了外部参与者在获得他们的 dTAO 奖励后，会立即卖掉的比例。这是模拟市场抛压的关键（包括 Root 验证者的自动抛售）。

#### 策略时间配置 🆕

*   **策略开始延迟**: 
    *   **双重输入方式**: 支持天数和区块数输入，互相自动转换
    *   **灵活范围**: 1 区块到模拟总天数对应的区块数
    *   **独立配置**: 与 TAO Emission 的 7200 区块免疫期完全独立
    *   **换算关系**: 1 天 = 7,200 区块（每 12 秒 1 个区块）

#### 双阶段投资策略参数

*   **二次增持金额 (TAO)**: 在初始投资基础上，进行二次增持的金额。默认为 4000 TAO，与初始预算 1000 TAO 形成 1:4 的投资比例。
*   **二次增持延迟**: 首次买入后，等待多少天进行二次增持。默认为 1 天，支持设置为 0（立即增持）。
*   **大量卖出触发倍数**: 当 TAO 储备达到总投资预算的多少倍时，触发大量卖出。默认为 3.0 倍，基于总投资金额（包含二次增持）。

## 🎯 重要机制说明

### TAO Emission 免疫期
基于对 `subtensor` 源码的验证：
- **前 7200 区块（约 1 天）为免疫期**
- 期间不会有 TAO 注入，也不会更新移动平均价格（PriceEMA）
- 此机制确保子网公平启动

### 策略灵活性
- **策略开始时间可独立配置**，与 TAO 免疫期分离
- 可选择立即开始（第 1 区块）或延迟开始
- 支持多种投资策略的模拟和优化

### dTAO 分配节奏
- **延迟分配机制**: dTAO 奖励每 360 区块（1 个 Tempo）统一分配
- **Root 自动抛售**: Root 验证者获得的 dTAO 会 100% 立即抛售为 TAO

## 🤝 贡献

欢迎通过提交 Issue 和 Pull Request 来为这个项目做出贡献。

## 📄 许可证

本项目采用 MIT 许可证。详情请见 `LICENSE` 文件。

## 📊 功能模块

### 1. 核心模拟引擎
- `src/core/amm_pool.py` - AMM池恒定乘积模型
- `src/core/emission.py` - 排放计算和分配逻辑
- `src/simulation/simulator.py` - 主模拟引擎

### 2. 交易策略
- `src/strategies/tempo_sell_strategy.py` - Tempo卖出策略

### 3. Web界面
- `app.py` - 主应用入口
- `src/visualization/` - 可视化组件

### 4. 分析工具
- `scripts/debug_alpha_impact.py` - Alpha参数影响诊断
- `scripts/analyze_roi_sources.py` - ROI来源分析
- `scripts/system_validation.py` - 系统验证

## 🔬 验证结果

基于 Bittensor v3.2.0 链上数据验证：
- ✅ α_base = 0.0003（链上实际参数）
- ✅ T_half = 201,600 区块（约 28 天）
- ✅ EMA 公式完全符合规范：α(t) = α_base × (t / (t + T_half))
- ✅ 免疫期机制正确实现（7200 区块）
- ✅ dTAO 分配节奏准确（每 360 区块）

## 📈 使用案例

### 测试不同 α_base 值的影响
1. 设置模拟时间：60-180 天
2. 调整 α_base：0.0001（超稳定）vs 0.0003（链上值）vs 0.01（快速收敛）
3. 观察价格收敛速度和 TAO 注入量差异
4. 分析不同参数下的 ROI 表现

### 优化策略开始时间
1. 测试立即开始（1 区块）vs 免疫期后开始（7200 区块）
2. 使用天数/区块数双重输入灵活调整
3. 对比不同开始时间的收益差异
4. 找到最优进场时机

### 模拟市场抛压影响
1. 调整外部卖出压力（0-100%）
2. 模拟 Root 验证者和其他参与者的抛售行为
3. 分析抛压对 dTAO 价格的影响
4. 制定应对策略

## 🛡️ 技术特点

- **高精度计算** - 基于Decimal，确保精确性
- **模块化设计** - 清晰的代码架构，易于扩展
- **实时验证** - 内置系统验证和诊断工具
- **用户友好** - 中文界面，详细的参数说明

## 📝 更新日志

### v2.1.0 (2025-07-10) 🆕
- 🎯 **α_base 参数优化**: 范围调整为 0.0001-0.2，默认值设为链上验证的 0.0003
- ⏰ **策略时间增强**: 添加天数/区块数双重输入，支持自动转换
- 🔧 **EMA 公式规范**: 完全符合 Bittensor v3.2.0 规范
- 🐛 **Bug 修复**: 修复策略 immunity_period 参数传递问题
- 📊 **UI 优化**: 添加时间换算信息，改进参数说明

### v2.0.0 (2025-01-04)
- 🔄 双阶段投资策略（初始投资 + 二次增持）
- 💰 精确的ROI计算（包含二次增持金额）
- 📊 优化的UI界面和参数配置
- 🐛 修复批量卖出触发条件和余额计算
- 🔧 完善的错误处理和状态管理
- 📈 改进的利润分析和资产展示

### v1.0.0 (2024-12-03)
- ✨ 可调Moving Alpha参数
- 📊 多策略对比分析
- 🔬 真实数据验证
- 🚀 云端部署支持

## 🔗 相关链接

- [TaoStats](https://taostats.io/) - Bittensor网络统计
- [Bittensor文档](https://docs.bittensor.com/)
