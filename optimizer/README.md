# 🎯 Bittensor 子网策略参数优化器

专业的量化策略优化系统，旨在找到**最快回本周期**的最优策略参数组合。

## 🚀 核心功能

### ✨ 主要特性
- **多目标优化**: 以最快回本为首要目标，最高收益为次要目标
- **双场景测试**: 支持 1000 TAO 和 5000 TAO 两种预算场景
- **滑点智能控制**: 自动调整交易数量确保滑点不超过5%
- **并行计算**: 支持多进程并行优化，大幅提升计算效率
- **详细报告**: 生成全面的优化报告和性能分析

### 🎛️ 优化参数
- **买入阈值** (`buy_threshold_price`): 0.1 - 0.8，步长 0.1
- **买入步长** (`buy_step_size_tao`): 0.05 - 1.0 TAO，步长 0.05
- **卖出触发倍数** (`sell_trigger_multiplier`): 1.2 - 4.0x，步长 0.2

## 📋 使用方法

### 1. 快速测试
```bash
# 运行功能验证测试
python test_optimizer.py

# 运行快速优化测试（4个参数组合）
python quick_test.py
```

### 2. 完整优化
```bash
# 运行完整参数优化（警告：可能需要数小时）
python optimizer_main.py
```

## 🔍 优化流程

### 第一步：参数网格生成
- **1000 TAO场景**: 8 × 20 × 15 = 2,400 个组合
- **5000 TAO场景**: 8 × 20 × 15 = 2,400 个组合
- **总计**: 4,800 个参数组合

### 第二步：并行模拟执行
- 使用多进程池并行运行模拟
- 每个组合运行60天完整模拟
- 实施5%滑点约束控制

### 第三步：结果分析排序
- 筛选能够回本的方案
- 按回本时间升序排序
- 相同回本时间下按总收益降序排序

### 第四步：最优解输出
- 分别输出两种场景的最优参数
- 生成详细的性能报告
- 保存完整结果到JSON文件

## 📊 输出结果

### 控制台报告
```
🎯 BITTENSOR 子网策略优化报告
================================================================================

📊 执行统计:
  - 总测试组合: 4,800
  - 成功模拟: 4,750
  - 失败模拟: 50
  - 总耗时: 3,420.5 秒
  - 并行进程: 8

🏆 1000 TAO场景 最优解:
--------------------------------------------------
✅ 找到最优策略参数:
  📈 买入阈值: 0.3
  📊 买入步长: 0.75 TAO
  🎯 卖出倍数: 2.2x

📋 性能指标:
  ⏱️  回本时间: 28.5 天
  💰 总回报: 245.67 TAO
  📈 最终ROI: 24.57%
  💵 总投资: 1000 TAO
  🏦 最终资产: 1245.67 TAO
```

### JSON结果文件
- 完整的优化结果保存在 `optimization_results_YYYYMMDD_HHMMSS.json`
- 包含所有参数组合的详细结果
- 支持后续分析和可视化

## 🔧 技术特性

### 滑点约束实现
```python
# 智能滑点控制：调整交易数量确保在合理滑点范围内部分成交
max_allowed_slippage = Decimal("0.05")  # 5% 最大允许滑点

# 二分法寻找最大可交易数量
for iteration in range(10):
    test_amount = (min_amount + max_amount) / 2
    predicted_slippage = calculate_slippage(test_amount)
    
    if predicted_slippage <= max_allowed_slippage:
        optimal_amount = test_amount
        min_amount = test_amount
    else:
        max_amount = test_amount
```

### 回本时间计算
- **目标**: 找到资产总价值 ≥ 初始投资的最早时间点
- **约束**: 必须成功回本才算有效解
- **次要目标**: 相同回本时间下选择最高收益方案

### 并行计算优化
- 自动检测CPU核心数
- 最多使用8个并行进程
- 分批处理避免内存溢出
- 实时进度显示

## ⚠️ 注意事项

### 计算资源需求
- **完整优化**: 4,800个组合 × 60天模拟 ≈ 2-4小时（8核CPU）
- **内存需求**: 建议至少8GB可用内存
- **磁盘空间**: 结果文件约10-50MB

### 参数调整建议
如需减少计算时间，可以调整：
```python
# 在 optimizer_main.py 中
"days": 30,  # 减少模拟天数
# 或减少参数搜索范围
'buy_threshold_price': [0.2, 0.3, 0.4],  # 减少测试值
```

## 📈 预期结果

### 1000 TAO场景预测
- **最优阈值**: 0.25-0.35（积极买入策略）
- **最优步长**: 0.5-1.0 TAO（匹配资金规模）
- **最优倍数**: 2.0-2.5x（快速回本导向）
- **预期回本时间**: 20-35天

### 5000 TAO场景预测  
- **最优阈值**: 0.3-0.4（避免过度推高价格）
- **最优步长**: 0.75-1.0 TAO（利用规模优势）
- **最优倍数**: 2.5-3.5x（可承受稍长回本期）
- **预期回本时间**: 25-40天

## 🛠️ 故障排除

### 常见问题
1. **模拟失败**: 检查参数配置是否合理
2. **内存不足**: 减少并行进程数或分批处理
3. **计算时间过长**: 考虑减少参数搜索空间

### 日志文件
- `optimizer.log`: 详细的运行日志
- 包含每个参数组合的执行状态
- 便于诊断失败原因

## 📝 开发说明

### 核心模块
- `ParameterGridGenerator`: 参数网格生成器
- `SimulationRunner`: 单次模拟运行器  
- `ResultAnalyzer`: 结果分析器
- `OptimizationEngine`: 优化引擎主类

### 扩展建议
- 添加更多优化目标（如风险调整收益）
- 实现遗传算法或贝叶斯优化
- 支持动态参数范围调整
- 集成可视化分析工具

---

🎉 **准备好找到最优策略参数了吗？运行 `python quick_test.py` 开始吧！**